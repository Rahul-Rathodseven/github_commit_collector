# Output Schema Documentation

## Overview
This document describes the structure of output files generated by the GitHub Commit Data Collector.

---

## JSON Output Format

### Main Commits File (`commits_TIMESTAMP.json`)

```json
{
  "metadata": {
    "collection_date": "2024-01-29T10:30:00",
    "total_repositories": 2,
    "total_commits_collected": 150,
    "repositories_processed": [
      "owner/repo1",
      "owner/repo2"
    ],
    "filters_applied": {
      "date_from": "2024-01-01",
      "date_to": "2024-12-31"
    }
  },
  "commits": [
    {
      "repository": {
        "name": "repo1",
        "owner": "owner",
        "url": "https://github.com/owner/repo1"
      },
      "commit": {
        "sha": "a1b2c3d4e5f6g7h8i9j0",
        "message": "Fix bug in authentication module",
        "date": "2024-01-15T14:23:45Z",
        "url": "https://github.com/owner/repo1/commit/a1b2c3d4",
        "branch": "main"
      },
      "author": {
        "name": "John Doe",
        "username": "johndoe",
        "email": "john@example.com",
        "team": "backend"
      },
      "statistics": {
        "total_additions": 45,
        "total_deletions": 12,
        "total_changes": 57,
        "files_changed": 3
      },
      "file_changes": [
        {
          "filename": "src/auth/login.py",
          "status": "modified",
          "additions": 30,
          "deletions": 8,
          "changes": 38,
          "patch": null
        },
        {
          "filename": "tests/test_auth.py",
          "status": "modified",
          "additions": 15,
          "deletions": 4,
          "changes": 19,
          "patch": null
        },
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 0,
          "deletions": 0,
          "changes": 0,
          "patch": null
        }
      ]
    }
  ],
  "total_commits": 150
}
```

### Collection Summary File (`collection_summary_TIMESTAMP.json`)

```json
{
  "metadata": {
    "collection_date": "2024-01-29T10:30:00",
    "total_repositories": 2,
    "total_commits_collected": 150,
    "repositories_processed": ["owner/repo1", "owner/repo2"],
    "filters_applied": {}
  },
  "overall_statistics": {
    "total_commits": 150,
    "unique_authors": 12,
    "unique_teams": 4,
    "total_additions": 5432,
    "total_deletions": 2109,
    "total_files_changed": 456
  },
  "repository_statistics": [
    {
      "repository": "owner/repo1",
      "total_commits": 85,
      "total_additions": 3201,
      "total_deletions": 1234,
      "total_files_changed": 267,
      "unique_authors": 8,
      "date_range": {
        "start": "2024-01-01T09:00:00Z",
        "end": "2024-01-28T17:45:00Z"
      },
      "teams_involved": ["backend", "frontend", "devops"]
    }
  ]
}
```

### Team Summary File (`team_summary_TIMESTAMP.json`)

```json
[
  {
    "team_name": "backend",
    "total_commits": 65,
    "total_additions": 2345,
    "total_deletions": 987,
    "total_files_changed": 189,
    "unique_authors": 5
  },
  {
    "team_name": "frontend",
    "total_commits": 48,
    "total_additions": 1876,
    "total_deletions": 654,
    "total_files_changed": 145,
    "unique_authors": 4
  }
]
```

### Repository Statistics File (`repository_stats_TIMESTAMP.json`)

```json
[
  {
    "repository": "owner/repo1",
    "total_commits": 85,
    "total_additions": 3201,
    "total_deletions": 1234,
    "total_files_changed": 267,
    "unique_authors": 8,
    "date_range": {
      "start": "2024-01-01T09:00:00Z",
      "end": "2024-01-28T17:45:00Z"
    },
    "teams_involved": ["backend", "frontend", "devops"]
  }
]
```

---

## CSV Output Format

### Main Commits File (`commits_TIMESTAMP.csv`)

| Column Name | Type | Description |
|------------|------|-------------|
| repository_name | string | Repository name |
| repository_owner | string | Repository owner |
| repository_url | string | Repository URL |
| commit_sha | string | Full commit SHA |
| commit_message | string | Commit message |
| commit_date | ISO8601 | Commit date and time |
| commit_url | string | URL to commit on GitHub |
| branch | string | Branch name |
| author_name | string | Author's name |
| author_username | string | Author's GitHub username |
| author_email | string | Author's email |
| team_name | string | Team name (from mapping) |
| total_additions | integer | Lines added |
| total_deletions | integer | Lines deleted |
| total_changes | integer | Total lines changed |
| files_changed_count | integer | Number of files changed |

**Example:**
```csv
repository_name,repository_owner,repository_url,commit_sha,commit_message,commit_date,commit_url,branch,author_name,author_username,author_email,team_name,total_additions,total_deletions,total_changes,files_changed_count
repo1,owner,https://github.com/owner/repo1,a1b2c3d4e5f6,Fix authentication bug,2024-01-15T14:23:45Z,https://github.com/owner/repo1/commit/a1b2c3d4,main,John Doe,johndoe,john@example.com,backend,45,12,57,3
```

### File Changes File (`commits_TIMESTAMP_file_changes.csv`)

Generated when `--include-file-details` flag is used.

| Column Name | Type | Description |
|------------|------|-------------|
| commit_sha | string | Commit SHA |
| commit_date | ISO8601 | Commit date |
| author_username | string | Author username |
| team_name | string | Team name |
| repository | string | owner/repo format |
| filename | string | File path |
| status | string | added/modified/deleted/renamed |
| additions | integer | Lines added to file |
| deletions | integer | Lines deleted from file |
| changes | integer | Total changes to file |

**Example:**
```csv
commit_sha,commit_date,author_username,team_name,repository,filename,status,additions,deletions,changes
a1b2c3d4e5f6,2024-01-15T14:23:45Z,johndoe,backend,owner/repo1,src/auth/login.py,modified,30,8,38
a1b2c3d4e5f6,2024-01-15T14:23:45Z,johndoe,backend,owner/repo1,tests/test_auth.py,modified,15,4,19
```

---

## Data Types Reference

### File Status Values
- `added` - New file added
- `modified` - Existing file modified
- `deleted` - File deleted
- `renamed` - File renamed

### Date Format
All dates use ISO 8601 format: `YYYY-MM-DDTHH:MM:SSZ` (UTC timezone)

### Team Assignment
- Authors are mapped to teams using `config/teams.yaml`
- Unmapped authors default to team specified in config (typically "unassigned")

---

## File Naming Conventions

All output files include timestamps in the format `YYYYMMDD_HHMMSS`:

- `commits_YYYYMMDD_HHMMSS.json` - Main commit data
- `commits_YYYYMMDD_HHMMSS.csv` - Commits in CSV format
- `commits_YYYYMMDD_HHMMSS_file_changes.csv` - Detailed file changes
- `collection_summary_YYYYMMDD_HHMMSS.json` - Collection summary
- `team_summary_YYYYMMDD_HHMMSS.json` - Team statistics
- `repository_stats_YYYYMMDD_HHMMSS.json` - Repository statistics

---

## Notes

1. **Patch Content**: By default, the `patch` field (actual diff content) is excluded from JSON output. Use `--include-patch` to include it.

2. **File Changes in CSV**: File-level details are only exported to CSV when using the `--include-file-details` flag, creating a separate CSV file.

3. **Null Values**: Fields may be `null` in JSON or empty in CSV if data is not available (e.g., `author_username` for commits without linked GitHub accounts).

4. **Metadata**: The main JSON file includes collection metadata showing when data was collected and what filters were applied.